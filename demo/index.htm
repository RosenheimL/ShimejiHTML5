<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<meta http-equiv="X-UA-Compatible" value="IE=9">
	<title>Shimeji HTML5 Demo</title>

	<!-- Library -->
	<link rel="stylesheet" href="../build/shimeji.css"/>
	<script type="text/javascript" src="../build/shimeji.js"></script>
</head>
<body>
	<div id="main" class="container">
		<h1>Shimeji Web Library Demonstration</h1>
		<p>
			<a href="#" class="btn" id="btn_reverse" style="color:#A00">Reverse</a>
			<a href="#" class="btn" id="btn_walk">Walk</a>
			<a href="#" class="btn" id="btn_climb">Climb</a>
			<a href="#" class="btn" id="btn_stand">Stand</a>
		</p>
		<div id="squalo" class="shimeji"></div>
		<div id="zbox" style="position:fixed;top:200px;left:200px;width:600px;height:600px;border:1px dashed #000;"></div>
	</div>
	<script>
		var $ = function(e){return document.getElementById(e);};
		var loadShimeji = function (config){
			var squalo = new Shimeji(config);
			squalo.init($("squalo"), 500, 700);
			var sq = [$("zbox")];
			squalo.makeEnvironment(sq);
			squalo.behavior("zbox", function(what, env){
				if(what === "exit_left"){
					squalo.place(env.left + 1, squalo._y);
					squalo.cancelAct();
					squalo.act("climb",4);
				}else if (what === "exit_right"){
					squalo.place(env.right - 1, squalo._y);
					squalo.cancelAct();
					squalo.act("climb",4, true);
				}else if (what === "exit_top"){
					// Decide which edge we are closer to
					if(Math.abs(squalo._x - env.left) < Math.abs(squalo._x - env.right)){
						squalo.place(squalo._x, env.top + 1);
						squalo.cancelAct();
						squalo.act("walk",2,true,false,function(){
							squalo.place(squalo._x, squalo._y + 10);
							squalo.act("sit_sing",1,true);
						});
					}else{
						squalo.place(squalo._x, env.top + 1);
						squalo.cancelAct();
						squalo.act("walk",2,false,false,function(){
							squalo.place(squalo._x, squalo._y + 10);
							squalo.act("sit_sing",1);
						});
					}
				}
				console.log([what, env, "Yo1"]);
			});
			squalo.act("stand");
			// Allow debug
			window.squalo = squalo;
		};
		window.addEventListener("load", function(){
			var xhr = new XMLHttpRequest();
			xhr.onreadystatechange = function(){
				if(xhr.readyState === 4){
					loadShimeji(JSON.parse(xhr.responseText));
					var isReversed = false;
					$("btn_reverse").addEventListener("click", function(){
						isReversed = !isReversed;
						$("btn_reverse").style.color= isReversed ? "#0A0" : "#A00";
					});
					$("btn_walk").addEventListener("click", function(){
						squalo.act("walk",1,isReversed);
					});
					$("btn_climb").addEventListener("click", function(){
						squalo.act("climb",1,isReversed);
					});
					$("btn_stand").addEventListener("click", function(){
						squalo.act("stand",1,isReversed);
					});
				};
			};
			xhr.open("GET","squalo/mascot.json", true);
			xhr.send();
		});
	</script>
</body>
</html>
